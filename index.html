<title>XSS</title>
<h1>WARNING: if you continue you will XSS yourself</h1>
<script>
"use strict";
 
let loop = setInterval(() => {
  window.moveTo(0, 0);
  if (innerWidth >= 500 && innerHeight >= 500) {
    clearInterval(loop);
    askUser();
  }
  if (innerWidth < 500 || innerHeight < 500) window.resizeTo(600, 600);
 }, 1000);

function askUser() {
  // Origin must be sandboxed and not in a iframe
  if (window.origin === "null" && window.opener === null && window.top === window && window.parent === window) {
    // Clean URL
    window.history.replaceState("", "", "?html=" + new URL(location.href).searchParams.get("html"));

    // Require user confirmation
    if(OTPConfirm() && window.confirm("WARNING: if you continue you will Self-XSS yourself for ndevtk.github.io") === true) {
      unsafe();
    } else {
      window.history.back();
    }
  } else {
    // Used for sandbox
    navigator.serviceWorker.register("https://ndevtk.github.io/cross-site/sw.js").then(_ => {
      location = location;
    });
  }
}

function unsafe() {
  // unsafe code to run code from url
  document.body.innerHTML = new URL(location.href).searchParams.get("html");
}

function OTPConfirm() {
  const OTP = generateOTP(8);
  const result = prompt('By continuing you agree to run UNTRUSTED code on this website if you want to allow this please type '+ OTP + ' other wise click cancel.');
  switch (result.toLowerCase()) {
    case 'you know better then i do':
      alert('You Used to Hold Me');
      break
    case 'why':
      alert('As the displayed url is https://ndevtk.github.io/* I feel responsible for its content.');
      break
    case 'make it harder':
      alert('Bit pointless but okay');
      for (let i = 0; i<10; i++) {
        if (OTPConfirm() === false) return false
      }
      break
    case 'help':
      alert("'help' is not recognized as an internal or external command, operable program or batch file.");
      break
    case 'whoami':
      alert('You are at '+ location.origin + ' using the origin ' + window.origin);
      break
  }
  return (result === OTP);
}

function generateOTP(length) {
  let password = '';
  let chars = "0123456789abcdefghijklmnopqrstuvwxyz!@#$%^&*()ABCDEFGHIJKLMNOPQRSTUVWXYZ"; // Possible characters that can appear in password
  let passwordLength = length;
  const array = new Uint32Array(length); // Create 'unsigned' array
  window.crypto.getRandomValues(array); // Assign random values to new array
  for (let i = 0; i < passwordLength; i++) {
    password += chars[array[i] % chars.length]; // % operator returns remainder of division
  }
  return password;
}
</script>
