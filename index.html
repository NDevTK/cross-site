<title>XSS</title>
<h1>WARNING: if you continue you will XSS yourself</h1>
<script>
"use strict";
// Origin must be sandboxed and not in a iframe
if (window.origin === "null" && window.opener === null && window.top === window && window.parent === window) {
  // Clean URL
  window.history.replaceState("", "", "?html=" + new URL(location.href).searchParams.get("html"));
  
  // Require user confirmation
  if(OTPConfirm() && window.confirm("WARNING: if you continue you will Self-XSS yourself for ndevtk.github.io/") === true) {
    unsafe();
  } else {
    window.history.back();
  }
} else {
  // Used for sandbox
  navigator.serviceWorker.register("https://ndevtk.github.io/cross-site/sw.js").then(_ => {
    location = location;
  });
}

function unsafe() {
  // unsafe code to run code from url
  document.body.innerHTML = new URL(location.href).searchParams.get("html");
}

function OTPConfirm() {
  const OTP = generateOTP(8);
  const result = prompt('By continuing you agree to run UNTRUSTED code on this website if you want to allow this please type '+ OTP + ' other wise click cancel.');
  return (result === OTP);
}

function generateOTP(length) {
  let password = '';
  let chars = "0123456789abcdefghijklmnopqrstuvwxyz!@#$%^&*()ABCDEFGHIJKLMNOPQRSTUVWXYZ"; // Possible characters that can appear in password
  let passwordLength = length;
  const array = new Uint32Array(length); // Create 'unsigned' array
  window.crypto.getRandomValues(array); // Assign random values to new array
  for (let i = 0; i < passwordLength; i++) {
    password += chars[array[i] % chars.length]; // % operator returns remainder of division
  }
  return password;
}
</script>
